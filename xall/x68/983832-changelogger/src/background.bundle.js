(()=>{"use strict";var e={416:(e,n,t)=>{n.browser=t(567)},567:e=>{e.exports=browser}},n={};function t(s){var o=n[s];if(void 0!==o)return o.exports;var r=n[s]={exports:{}};return e[s](r,r.exports,t),r.exports}(()=>{var e=t(416);class n{constructor(e){var n,t,s,o;e=null!=e?e:{},this.badge=null===(n=e.badge)||void 0===n||n,this.notification=null===(t=e.notification)||void 0===t||t,this.max=null!==(s=e.max)&&void 0!==s?s:10,this.ignore_no_changelogs=null!==(o=e.ignore_no_changelogs)&&void 0!==o&&o}}const s=new class{constructor(){this.lock=!1,this.waitlist=[]}getLock(){return this.lock?new Promise(((e,n)=>{this.waitlist.push({resolve:e,reject:n})})):(this.lock=!0,Promise.resolve())}releaseLock(){var e;if(this.lock){if(0===this.waitlist.length)return void(this.lock=!1);null===(e=this.waitlist.shift())||void 0===e||e.resolve()}}};async function o(t){var o;if("development"===t.installType)return;if(void 0===t.id)return;const r=new n((await e.browser.storage.local.get()).options),i=await async function(n){if(void 0===n)return null;const t=new URL("https://addons.thunderbird.net/api/v4/addons/addon");t.pathname+="/"+n,t.searchParams.append("lang",e.browser.i18n.getUILanguage());const s=await fetch(t.href);return s.status>=200&&s.status<=299?await s.json():null}(t.id);if(null!==i){if(t.version===i.current_version.version){let n;if(null===i.current_version.release_notes){if(r.ignore_no_changelogs)return;n=e.browser.i18n.getMessage("noChangelog")}else n=i.current_version.release_notes;const a={id:t.id,version:i.current_version.version,icon:i.icon_url.split("?")[0],name:i.name,release_notes:n,url:i.url};await s.getLock();const l=(null!==(o=(await e.browser.storage.local.get()).changelogs)&&void 0!==o?o:[]).filter((e=>e.id!==a.id||e.version!==a.version));for(l.unshift(a);l.length>r.max;)l.pop();await e.browser.storage.local.set({changelogs:l}),s.releaseLock(),r.notification&&e.browser.notifications.create({type:"basic",title:e.browser.i18n.getMessage("updateTitle",[t.name,t.version]),message:a.release_notes,iconUrl:a.icon}),r.badge&&e.browser.browserAction.setBadgeText({text:"!"})}}else console.log("Could not find extension %s",t.id)}e.browser.management.onInstalled.addListener(o),e.browser.runtime.onInstalled.addListener((async function(n){if(await e.browser.storage.local.get(),"install"===n.reason||"update"===n.reason){const n=e.browser.runtime.getManifest();o({name:n.name,id:"changelogger@r01",version:n.version})}}))})()})();
//# sourceMappingURL=background.bundle.js.map